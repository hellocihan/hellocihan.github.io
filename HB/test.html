<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Transparan G√∂rsel D√ºzeltici</title>
<style>
  body {
    font-family: sans-serif;
    background: #f6f6f6;
    margin: 40px;
    text-align: center;
  }
  input {
    width: 80%;
    max-width: 500px;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  button {
    margin-top: 10px;
    padding: 10px 16px;
    font-size: 15px;
    background-color: #ff6000;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover { background-color: #e05500; }
  #canvas { 
    margin-top: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: transparent;
    max-width: 100%;
  }
  #loading {
    display: none;
    margin-top: 20px;
    font-weight: bold;
  }
  #downloadLink {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
</style>
</head>
<body>

<h2>üé® Transparan G√∂rsel D√ºzeltici</h2>
<p>URL girin ve ger√ßek transparan PNG elde edin:</p>

<input type="text" id="imageUrlInput" placeholder="G√∂rsel URL‚Äôsi buraya">
<br>
<button id="processBtn">Transparan Arka Plan Uygula</button>
<div id="loading">‚è≥ G√∂rsel y√ºkleniyor ve i≈üleniyor...</div>

<canvas id="canvas"></canvas>
<a id="downloadLink" href="#" download="transparent_fixed.png" style="display:none;">‚¨áÔ∏è PNG ƒ∞ndir</a>

<script>
async function loadImageWithFallback(url) {
  try {
    const response = await fetch(url, { mode: 'cors' });
    if (!response.ok) throw new Error('Direct fetch failed');
    return await response.blob();
  } catch (e) {
    console.warn('Proxy kullanƒ±lacak:', e.message);
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
    const proxyResponse = await fetch(proxyUrl);
    if (!proxyResponse.ok) throw new Error('Proxy fetch failed');
    return await proxyResponse.blob();
  }
}

document.getElementById('processBtn').addEventListener('click', async () => {
  const imageUrl = document.getElementById('imageUrlInput').value.trim();
  if (!imageUrl) return alert("L√ºtfen bir g√∂rsel URL'si girin");

  const loading = document.getElementById('loading');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const downloadLink = document.getElementById('downloadLink');
  downloadLink.style.display = 'none';
  loading.style.display = 'block';

  try {
    const blob = await loadImageWithFallback(imageUrl);
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = URL.createObjectURL(blob);

    img.onload = () => {
      // Canvas ayarla
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);

      // Transparan yap
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        // Checkerboard veya a√ßƒ±k gri alanlarƒ± alfa 0 yap
        if (r > 220 && g > 220 && b > 220) {
          data[i + 3] = 0;
        }
      }

      ctx.putImageData(imageData, 0, 0);

      // PNG olarak indirilebilir link
      const cleanPng = canvas.toDataURL("image/png");
      downloadLink.href = cleanPng;
      downloadLink.style.display = "block";

      loading.style.display = "none";
    };
    img.onerror = () => { 
      loading.style.display = "none";
      alert("G√∂rsel y√ºklenemedi. URL doƒüru mu?"); 
    };

  } catch (err) {
    loading.style.display = "none";
    console.error(err);
    alert("G√∂rsel y√ºklenemedi. URL veya eri≈üim hatasƒ± olabilir.");
  }
});
</script>

</body>
</html>
